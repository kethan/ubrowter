var __defProp=Object.defineProperty,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,r)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__spreadValues=(e,t)=>{for(var r in t||(t={}))__hasOwnProp.call(t,r)&&__defNormalProp(e,r,t[r]);if(__getOwnPropSymbols)for(var r of __getOwnPropSymbols(t))__propIsEnum.call(t,r)&&__defNormalProp(e,r,t[r]);return e};!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ubrow={})}(this,(function(e){"use strict";function t(e,t){var r,o,n,s="";for(r in e)if(void 0!==(n=e[r]))if(Array.isArray(n))for(o=0;o<n.length;o++)s&&(s+="&"),s+=encodeURIComponent(r)+"="+encodeURIComponent(n[o]);else s&&(s+="&"),s+=encodeURIComponent(r)+"="+encodeURIComponent(n);return(t||"")+s}function r(e){if(!e)return"";var t=decodeURIComponent(e);return"false"!==t&&("true"===t||(0*+t==0?+t:t))}function o(e){for(var t,o,n={},s=e.split("&");t=s.shift();)void 0!==n[o=(t=t.split("=")).shift()]?n[o]=[].concat(n[o],r(t.shift())):n[o]=r(t.shift());return n}function n(e,t){const r=[],o=new RegExp("^"+e.replace(/\((.*?)\)/g,"(?:$1)?").replace(/(\(\?)?:\w+/g,((e,t)=>(r.push(e.slice(1)),t?e:"([^/?]+)"))).replace(/\*/g,(()=>(r.push("path"),"([^?]*?)")))+"(?:\\?([\\s\\S]*))?$").exec(t),n={};if(o)for(let s=0;s<r.length;s++)n[r[s]]=o[s+1];return{match:!!o,params:n,pattern:e,url:t}}e.Browter=class extends class{constructor(){this.routes=[],this.handlers=[]}use(...e){return this.handlers=[...this.handlers,...e],this}get(e,...t){return this.routes.push({path:e,method:"GET",handlers:t}),this}handler({req:e,res:t,onError:r,onMatch:s,onNoMatch:i}){let a=!1;for(const{path:l,handlers:h}of this.routes.filter((t=>t.method.toLowerCase()==e.method.toLowerCase()))){let s=n(l,e.url);if(s.match){a=!0;let n=[...this.handlers,...h];e.params=s.params,e.path=s.url,e.routePath=l,e.query=o(s.url.split("?")[1]||"");let i=(e,t)=>{try{let o=n.shift();o?o(e,t,(o=>o?r(o,e,t):i(e,t))):r(null,e,t)}catch(o){r(o,e,t)}};i(e,t)}}a||i(e,t)}}{constructor(){super(),this.listener={onError:()=>{},onMatch:()=>{},onNoMatch:()=>{}},this.click=e=>{var t=e.target.closest("a"),r=t&&t.getAttribute("href");e.ctrlKey||e.metaKey||e.altKey||e.shiftKey||e.button||e.defaultPrevented||r&&!t.target&&t.host===location.host&&"#"!=r[0]&&(e.preventDefault(),r!=location.pathname+location.search&&this.redirect(r))}}redirect(e,r={},o=!1){let n={url:e,method:"GET"};(e+=0!==Object.keys(r).length?t(r,"?"):"")==location.pathname+location.search||o?history.replaceState(e,"",e):history.pushState(e,"",e),this.handler(__spreadValues({req:n,res:{redirect:this.redirect.bind(this),send:(e=>this.listener.onMatch(n,e)).bind(this)}},this.listener))}route(){this.redirect(location.pathname+location.search)}unlisten(){removeEventListener("popstate",this.route.bind(this)),removeEventListener("click",this.click)}listen(e=this.listener){this.listener=e,addEventListener("popstate",this.route.bind(this)),addEventListener("click",this.click),this.route()}},e.decode=o,e.encode=t,e.pathToRegex=n,Object.defineProperty(e,"__esModule",{value:!0}),e[Symbol.toStringTag]="Module"}));
