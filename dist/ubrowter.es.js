var t=Object.defineProperty,e=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,n=(e,r,s)=>r in e?t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[r]=s;function o(t,e){const r=[],s=new RegExp("^"+t.replace(/\((.*?)\)/g,"(?:$1)?").replace(/(\(\?)?:\w+/g,((t,e)=>(r.push(t.slice(1)),e?t:"([^/?]+)"))).replace(/\*/g,(()=>(r.push("path"),"([^?]*?)")))+"(?:\\?([\\s\\S]*))?$").exec(e),n={};if(s)for(let o=0;o<r.length;o++)n[r[o]]=s[o+1];return{match:!!s,params:n,pattern:t,url:e}}function i(t,e){var r,s,n,o="";for(r in t)if(void 0!==(n=t[r]))if(Array.isArray(n))for(s=0;s<n.length;s++)o&&(o+="&"),o+=encodeURIComponent(r)+"="+encodeURIComponent(n[s]);else o&&(o+="&"),o+=encodeURIComponent(r)+"="+encodeURIComponent(n);return(e||"")+o}function a(t){if(!t)return"";var e=decodeURIComponent(t);return"false"!==e&&("true"===e||(0*+e==0?+e:e))}function h(t){for(var e,r,s={},n=t.split("&");e=n.shift();)void 0!==s[r=(e=e.split("=")).shift()]?s[r]=[].concat(s[r],a(e.shift())):s[r]=a(e.shift());return s}class l extends class{constructor(){this.routes=[],this.handlers=[]}use(...t){return this.handlers=[...this.handlers,...t],this}get(t,...e){return this.routes.push({path:t,method:"GET",handlers:e}),this}handler({req:t,res:e,onError:r,onMatch:s,onNoMatch:n}){let i=!1;for(const{path:a,handlers:l}of this.routes.filter((e=>e.method.toLowerCase()==t.method.toLowerCase()))){let s=o(a,t.url);if(s.match){i=!0;let n=[...this.handlers,...l];t.params=s.params,t.path=s.url,t.routePath=a,t.query=h(s.url.split("?")[1]||"");let o=(t,e)=>{try{let s=n.shift();s?s(t,e,(s=>s?r(s,t,e):o(t,e))):r(null,t,e)}catch(s){r(s,t,e)}};o(t,e)}}i||n(t,e)}}{constructor(){super(),this.listener={onError:()=>{},onMatch:()=>{},onNoMatch:()=>{}},this.click=t=>{var e=t.target.closest("a"),r=e&&e.getAttribute("href");t.ctrlKey||t.metaKey||t.altKey||t.shiftKey||t.button||t.defaultPrevented||r&&!e.target&&e.host===location.host&&"#"!=r[0]&&(t.preventDefault(),r!=location.pathname+location.search&&this.redirect(r))}}redirect(t,o={},a=!1){let h={url:t,method:"GET"};(t+=0!==Object.keys(o).length?i(o,"?"):"")==location.pathname+location.search||a?history.replaceState(t,"",t):history.pushState(t,"",t),this.handler(((t,o)=>{for(var i in o||(o={}))r.call(o,i)&&n(t,i,o[i]);if(e)for(var i of e(o))s.call(o,i)&&n(t,i,o[i]);return t})({req:h,res:{redirect:this.redirect.bind(this),send:(t=>this.listener.onMatch(h,t)).bind(this)}},this.listener))}route(){this.redirect(location.pathname+location.search)}unlisten(){this.routes=[],this.handlers=[],removeEventListener("popstate",this.route.bind(this)),removeEventListener("click",this.click)}listen(t=this.listener){this.listener=t,addEventListener("popstate",this.route.bind(this)),addEventListener("click",this.click),this.route()}}export{l as Browter,h as decode,i as encode,o as pathToRegex};
