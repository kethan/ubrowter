function t(t,e){var r,n,s,o="";for(r in t)if(void 0!==(s=t[r]))if(Array.isArray(s))for(n=0;n<s.length;n++)o&&(o+="&"),o+=encodeURIComponent(r)+"="+encodeURIComponent(s[n]);else o&&(o+="&"),o+=encodeURIComponent(r)+"="+encodeURIComponent(s);return(e||"")+o}function e(t){if(!t)return"";var e=decodeURIComponent(t);return"false"!==e&&("true"===e||(0*+e==0?+e:e))}function r(t){for(var r,n,s={},o=t.split("&");r=o.shift();)void 0!==s[n=(r=r.split("=")).shift()]?s[n]=[].concat(s[n],e(r.shift())):s[n]=e(r.shift());return s}function n(t,e){const r=[],n=new RegExp("^"+t.replace(/\((.*?)\)/g,"(?:$1)?").replace(/(\(\?)?:\w+/g,((t,e)=>(r.push(t.slice(1)),e?t:"([^/?]+)"))).replace(/\*/g,(()=>(r.push("path"),"([^?]*?)")))+"(?:\\?([\\s\\S]*))?$").exec(e),s={};if(n)for(let o=0;o<r.length;o++)s[r[o]]=n[o+1];return{match:!!n,params:s,pattern:t,url:e}}class s extends class{constructor(){this.routes=[],this.handlers=[]}use(...t){return this.handlers=[...this.handlers,...t],this}get(t,...e){return this.routes.push({path:t,method:"GET",handlers:e}),this}handler({req:t,res:e,onError:s,onMatch:o,onNoMatch:i}){let h=!1;for(const{path:a,handlers:c}of this.routes.filter((e=>e.method.toLowerCase()==t.method.toLowerCase()))){let o=n(a,t.url);if(o.match){h=!0;let n=[...this.handlers,...c];t.params=o.params,t.path=o.url,t.routePath=a,t.query=r(o.url.split("?")[1]||"");let i=(t,e)=>{try{let r=n.shift();r?r(t,e,(r=>r?s(r,t,e):i(t,e))):s(null,t,e)}catch(r){s(r,t,e)}};i(t,e)}}h||i(t,e)}}{constructor(){super(),this.listener={onError:()=>{},onMatch:()=>{},onNoMatch:()=>{}},this.click=t=>{var e=t.target.closest("a"),r=e&&e.getAttribute("href");t.ctrlKey||t.metaKey||t.altKey||t.shiftKey||t.button||t.defaultPrevented||r&&!e.target&&e.host===location.host&&"#"!=r[0]&&(t.preventDefault(),r!=location.pathname+location.search&&this.redirect(r))}}redirect(e,r={},n=!1){let s={url:e,method:"GET"};e+=0!==Object.keys(r).length?t(r,"?"):"";let o={onMatch:(t,r)=>{e==location.pathname+location.search||n?history.replaceState(e,"",e):history.pushState(e,"",e),this.listener.onMatch(t,r)}};this.handler({req:s,res:{redirect:this.redirect.bind(this),send:(t=>o.onMatch(s,t)).bind(this)},onError:(t,e,r)=>{this.listener.onError(t,e,r)},onMatch:o.onMatch,onNoMatch:(t,e)=>{this.listener.onNoMatch(t,e)}})}route(){this.redirect(location.pathname+location.search)}unlisten(){removeEventListener("popstate",this.route.bind(this)),removeEventListener("click",this.click)}listen(t=this.listener){this.listener=t,addEventListener("popstate",this.route.bind(this)),addEventListener("click",this.click),this.route()}}export{s as Browter,r as decode,t as encode,n as pathToRegex};
